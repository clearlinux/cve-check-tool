include $(top_srcdir)/common.mk

if COVERAGE
AM_CFLAGS += --coverage
endif

bin_PROGRAMS = \
	cve-check-tool \
	cve-check-update

noinst_LTLIBRARIES = \
	libcve.la

libcve_la_SOURCES = \
	library/common.h \
	library/cve-check-tool.h \
	library/cve-string.h \
	library/cve-string.c \
	library/fetch.c \
	library/fetch.h \
	library/template.c \
	library/template.h \
	library/util.c \
	library/util.h \
	packaging/eopkg.c \
	packaging/eopkg.h \
	packaging/rpm.h \
	packaging/rpm.c \
	packaging/faux.h \
	packaging/faux.c \
	packaging/pkgbuild.h \
	packaging/pkgbuild.c \
	core.h \
	core.c

libcve_la_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(LIBCURL_CFLAGS) \
	$(AM_CFLAGS) \
	$(LIBJSON_GLIB_CFLAGS) \
	$(LIBGOBJECT_CFLAGS) \
	$(SQLITE_CFLAGS) \
	$(AM_CFLAGS)

libcve_la_LIBADD = \
	$(GLIB_LIBS) \
	$(GIO_LIBS) \
	$(LIBXML2_LIBS) \
	$(LIBCURL_LIBS) \
	$(LIBJSON_GLIB_LIBS) \
	$(LIBGOBJECT_LIBS) \
	$(SQLITE_LIBS)

cve_check_tool_SOURCES = \
	main.c \
	update.h \
	update.c \
	plugin-manager.c \
	plugin-manager.h \
	plugin.h \
	plugins/jira/jira.c \
	plugins/jira/jira.h


cve_check_tool_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(LIBCURL_CFLAGS) \
	$(AM_CFLAGS) \
	$(LIBJSON_GLIB_CFLAGS) \
	$(LIBGOBJECT_CFLAGS) \
	$(SQLITE_CFLAGS)


cve_check_tool_LDADD = \
	$(GLIB_LIBS) \
	$(GIO_LIBS) \
	$(LIBXML2_LIBS) \
	$(LIBCURL_LIBS) \
	$(LIBJSON_GLIB_LIBS) \
	$(LIBGOBJECT_LIBS) \
	$(SQLITE_LIBS) \
	libcve.la \
	-ldl

cve_check_update_SOURCES = \
	update.c \
	update.h \
	update-main.c


cve_check_update_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(LIBCURL_CFLAGS) \
	$(AM_CFLAGS) \
	$(LIBJSON_GLIB_CFLAGS) \
	$(LIBGOBJECT_CFLAGS) \
	$(SQLITE_CFLAGS)


cve_check_update_LDADD = \
	$(GLIB_LIBS) \
	$(GIO_LIBS) \
	$(LIBXML2_LIBS) \
	$(LIBCURL_LIBS) \
	$(LIBJSON_GLIB_LIBS) \
	$(LIBGOBJECT_LIBS) \
	$(SQLITE_LIBS) \
	libcve.la \
	-ldl


# Plugins, currently providing report facilities
pkglib_LTLIBRARIES = \
	html.la \
	cli.la \
	csv.la

MODULE_FLAGS = \
	$(AM_LDFLAGS) \
	-fvisibility=hidden \
	-module \
	-avoid-version

# HTML Module
html_la_SOURCES = \
	output/html.c

html_la_LIBADD = \
	$(GLIB_LIBS) \
	$(LIBXML2_LIBS) \
	libcve.la

html_la_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(AM_CFLAGS)

html_la_LDFLAGS = \
	$(MODULE_FLAGS)

# CSV module
csv_la_SOURCES = \
	output/csv.c

csv_la_LIBADD = \
	$(GLIB_LIBS) \
	$(LIBXML2_LIBS) \
	libcve.la

csv_la_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(AM_CFLAGS)

csv_la_LDFLAGS = \
	$(MODULE_FLAGS)

# CLI output
cli_la_SOURCES = \
	output/cli.c \
	output/cli.h

cli_la_LIBADD = \
	$(GLIB_LIBS) \
	$(LIBXML2_LIBS) \
	libcve.la

cli_la_CFLAGS = \
	$(GLIB_CFLAGS) \
	$(GIO_CFLAGS) \
	$(LIBXML2_CFLAGS) \
	$(AM_CFLAGS)

cli_la_LDFLAGS = \
	$(MODULE_FLAGS)
